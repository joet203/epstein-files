<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Epstein Files ‚Äî Dataset 9 Browser</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0d1117; color: #c9d1d9; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', monospace; padding: 20px; }
a { color: #58a6ff; text-decoration: none; }
a:hover { text-decoration: underline; }
.container { max-width: 1400px; margin: 0 auto; }
h1 { font-size: 24px; color: #f0f6fc; margin-bottom: 8px; }
.subtitle { color: #8b949e; font-size: 14px; margin-bottom: 20px; }
.top-bar { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
.stats { background: #161b22; border: 1px solid #21262d; border-radius: 8px; padding: 12px 20px; display: flex; gap: 20px; }
.stat { text-align: center; }
.stat .num { font-size: 20px; font-weight: 700; color: #f0f6fc; }
.stat .label { color: #8b949e; font-size: 11px; }
.btn {
    padding: 10px 20px; border: none; border-radius: 6px; font-size: 14px;
    cursor: pointer; font-weight: 600; transition: all 0.2s;
}
.btn-primary { background: #238636; color: #fff; }
.btn-primary:hover { background: #2ea043; }
.btn-secondary { background: #21262d; color: #c9d1d9; border: 1px solid #30363d; }
.btn-secondary:hover { background: #30363d; }
.btn-star { background: #9e6a03; color: #fff; }
.btn-star:hover { background: #bb8009; }
.btn-junk { background: #6e7681; color: #fff; }
.btn-junk:hover { background: #848d97; }
.btn-danger { background: #da3633; color: #fff; }
.btn-danger:hover { background: #f85149; }
.main-content { display: flex; gap: 20px; }
.viewer-panel { flex: 1; min-width: 0; }
.sidebar { width: 280px; flex-shrink: 0; }
.current-file { background: #161b22; border: 1px solid #21262d; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
.current-file .filename { font-family: monospace; font-size: 14px; color: #f0f6fc; margin-bottom: 12px; word-break: break-all; }
.current-file .actions { display: flex; gap: 8px; flex-wrap: wrap; }
.current-file .actions .btn { padding: 8px 12px; font-size: 12px; }
.pdf-frame { width: 100%; height: calc(100vh - 200px); min-height: 500px; border: 1px solid #21262d; border-radius: 8px; background: #161b22; }
.pdf-frame iframe { width: 100%; height: 100%; border: none; border-radius: 8px; }
.pdf-placeholder { display: flex; align-items: center; justify-content: center; height: 100%; color: #8b949e; font-size: 16px; }
.list-section { background: #161b22; border: 1px solid #21262d; border-radius: 8px; padding: 12px; margin-bottom: 12px; }
.list-section h3 { font-size: 13px; color: #8b949e; margin-bottom: 8px; display: flex; justify-content: space-between; }
.list-section h3 span { color: #58a6ff; }
.file-list { max-height: 150px; overflow-y: auto; }
.file-item { font-family: monospace; font-size: 11px; padding: 4px 8px; border-radius: 4px; margin-bottom: 4px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
.file-item:hover { background: #21262d; }
.file-item.starred { background: #3d2e00; border-left: 2px solid #9e6a03; }
.file-item .remove { color: #8b949e; font-size: 14px; padding: 0 4px; }
.file-item .remove:hover { color: #f85149; }
.note { background: #161b22; border-left: 3px solid #f0883e; padding: 10px 12px; margin-bottom: 16px; font-size: 12px; color: #8b949e; }
.tabs { display: flex; gap: 4px; margin-bottom: 12px; }
.tab { padding: 8px 12px; background: #21262d; border: none; color: #8b949e; border-radius: 6px 6px 0 0; cursor: pointer; font-size: 12px; }
.tab.active { background: #161b22; color: #f0f6fc; }
</style>
</head>
<body>
<div class="container">
    <h1>Dataset 9 Browser</h1>
    <div class="subtitle">Crowdsourced review of 1.2M PDFs from Dataset 9 ‚Äî one of 12 datasets in the DOJ Epstein Files</div>

    <div class="note">
        <strong>Note:</strong> Files hosted on justice.gov require age verification once per session. Mark important files with ‚≠ê to save them.
    </div>

    <div class="top-bar">
        <div class="stats">
            <div class="stat"><div class="num" id="totalCount">...</div><div class="label">Total Files</div></div>
            <div class="stat"><div class="num" id="viewedCount">0</div><div class="label">Viewed</div></div>
            <div class="stat"><div class="num" id="starredCount">0</div><div class="label">Starred</div></div>
            <div class="stat"><div class="num" id="junkCount">0</div><div class="label">Junk</div></div>
        </div>
        <button class="btn btn-primary" onclick="openRandom()">Open Random Unreviewed</button>
        <button class="btn btn-secondary" onclick="openRandom(true)">Any Random</button>
    </div>

    <div class="main-content">
        <div class="viewer-panel">
            <div class="current-file" id="currentFile" style="display:none">
                <div class="filename" id="currentFilename"></div>
                <div class="actions">
                    <button class="btn btn-star" onclick="markStarred()">‚≠ê Star</button>
                    <button class="btn btn-junk" onclick="markJunk()">üóë Junk</button>
                    <a id="newTabLink" href="#" target="_blank" class="btn btn-secondary">Open in New Tab</a>
                </div>
            </div>
            <div class="pdf-frame" id="pdfFrame">
                <div class="pdf-placeholder">Click "Open Random" to start reviewing files</div>
            </div>
        </div>

        <div class="sidebar">
            <div class="list-section">
                <h3>‚≠ê Starred Files <span id="starredListCount">0</span></h3>
                <div class="file-list" id="starredList"></div>
            </div>
            <div class="list-section">
                <h3>Recently Viewed <span id="recentListCount">0</span></h3>
                <div class="file-list" id="recentList"></div>
            </div>
            <div class="list-section">
                <h3>üóë Marked as Junk <span id="junkListCount">0</span></h3>
                <div class="file-list" id="junkList" style="max-height:100px"></div>
            </div>
            <button class="btn btn-secondary" onclick="exportData()" style="width:100%;margin-top:8px">Export Starred List</button>
        </div>
    </div>
</div>

<script>
let IDS = [];
let loaded = false;
let currentId = null;

// localStorage keys
const VIEWED_KEY = 'epstein_viewed';
const STARRED_KEY = 'epstein_starred';
const JUNK_KEY = 'epstein_junk';

function getSet(key) {
    try { return new Set(JSON.parse(localStorage.getItem(key) || '[]')); }
    catch { return new Set(); }
}
function saveSet(key, set) {
    localStorage.setItem(key, JSON.stringify([...set]));
}

let viewed = getSet(VIEWED_KEY);
let starred = getSet(STARRED_KEY);
let junk = getSet(JUNK_KEY);

// Load IDs
fetch("/static/ids.json")
    .then(r => r.json())
    .then(nums => {
        IDS = nums;
        loaded = true;
        updateStats();
    });

function makeId(num) {
    return "EFTA" + String(num).padStart(8, "0");
}

function makeUrl(id) {
    return `https://www.justice.gov/epstein/files/DataSet%209/${id}.pdf`;
}

function updateStats() {
    document.getElementById("totalCount").textContent = IDS.length.toLocaleString();
    document.getElementById("viewedCount").textContent = viewed.size.toLocaleString();
    document.getElementById("starredCount").textContent = starred.size.toLocaleString();
    document.getElementById("junkCount").textContent = junk.size.toLocaleString();
    document.getElementById("starredListCount").textContent = starred.size;
    document.getElementById("recentListCount").textContent = Math.min(viewed.size, 20);
    document.getElementById("junkListCount").textContent = junk.size;
    renderLists();
}

function renderLists() {
    // Starred
    const starredEl = document.getElementById("starredList");
    const starredArr = [...starred];
    starredEl.innerHTML = starredArr.length ? starredArr.map(id => `
        <div class="file-item starred" onclick="loadFile('${id}', true)">
            <span>${id}</span>
            <span class="remove" onclick="event.stopPropagation();unstar('${id}')">&times;</span>
        </div>
    `).join('') : '<div style="color:#8b949e;font-size:11px;padding:8px">No starred files yet</div>';

    // Recent (last 20)
    const recentEl = document.getElementById("recentList");
    const recentArr = [...viewed].slice(-20).reverse();
    recentEl.innerHTML = recentArr.length ? recentArr.map(id => `
        <div class="file-item" onclick="loadFile('${id}', true)">
            <span>${id}</span>
            ${starred.has(id) ? '‚≠ê' : ''}
        </div>
    `).join('') : '<div style="color:#8b949e;font-size:11px;padding:8px">No files viewed yet</div>';

    // Junk (last 10)
    const junkEl = document.getElementById("junkList");
    const junkArr = [...junk].slice(-10).reverse();
    junkEl.innerHTML = junkArr.length ? junkArr.map(id => `
        <div class="file-item" onclick="loadFile('${id}', true)">
            <span>${id}</span>
            <span class="remove" onclick="event.stopPropagation();unjunk('${id}')">&times;</span>
        </div>
    `).join('') : '<div style="color:#8b949e;font-size:11px;padding:8px">No junk marked</div>';
}

function loadFile(id, openTab = true) {
    currentId = id;
    const url = makeUrl(id);
    document.getElementById("currentFile").style.display = "block";
    document.getElementById("currentFilename").textContent = id + ".pdf";
    document.getElementById("newTabLink").href = url;
    document.getElementById("pdfFrame").innerHTML = `<div class="pdf-placeholder">PDF opened in new tab<br><br><a href="${url}" target="_blank" style="color:#58a6ff">Click here if it didn't open</a></div>`;

    if (openTab) {
        window.open(url, "_blank");
    }

    viewed.add(id);
    saveSet(VIEWED_KEY, viewed);
    updateStats();
}

function openRandom(anyRandom = false) {
    if (!loaded) {
        alert("Still loading file list...");
        return;
    }

    let candidates = IDS;
    if (!anyRandom) {
        // Filter to unreviewed (not viewed and not junk)
        candidates = IDS.filter(n => {
            const id = makeId(n);
            return !viewed.has(id) && !junk.has(id);
        });
    }

    if (!candidates.length) {
        alert("All files have been reviewed!");
        return;
    }

    const num = candidates[Math.floor(Math.random() * candidates.length)];
    const id = makeId(num);
    loadFile(id);
}

function markStarred() {
    if (!currentId) return;
    starred.add(currentId);
    junk.delete(currentId);
    saveSet(STARRED_KEY, starred);
    saveSet(JUNK_KEY, junk);
    updateStats();
}

function markJunk() {
    if (!currentId) return;
    junk.add(currentId);
    starred.delete(currentId);
    saveSet(JUNK_KEY, junk);
    saveSet(STARRED_KEY, starred);
    updateStats();
    // Auto-load next
    openRandom();
}

function unstar(id) {
    starred.delete(id);
    saveSet(STARRED_KEY, starred);
    updateStats();
}

function unjunk(id) {
    junk.delete(id);
    saveSet(JUNK_KEY, junk);
    updateStats();
}

function exportData() {
    const data = {
        starred: [...starred],
        viewed: viewed.size,
        junk: junk.size,
        exported: new Date().toISOString()
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'epstein-starred-files.json';
    a.click();
}

// Initialize
updateStats();
</script>
</body>
</html>
